



import "tfplan-functions" as plan


allowed_zones = [
    "us-east-1a", "us-east-1b", "us-west-1c", "us-west-1a"
]

allEC2Instances = plan.find_resources("aws_instance")


violatingEC2Instances = plan.filter_attribute_not_contains_list(allEC2Instances,
    "availability_zone", allowed_zones, true)


# Main Rule

main = rule {
    length(violatingEC2Instances["messages"]) is 0
}